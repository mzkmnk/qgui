# Amazon Q CLI 出力フォーマット調査

## 1. 基本的な出力構造

### 起動時の表示
- Amazon QのASCIIアートロゴ（青色）
- "Did you know?" ヒントボックス
- コマンドヘルプバー
- 使用中のモデル情報

### ANSIエスケープコード
Amazon Q CLIは豊富なANSIエスケープコードを使用：

#### 色コード
- `[38;5;10m` - 緑色（ユーザー入力）
- `[38;5;14m` - 水色（システムメッセージ）
- `[38;5;13m` - マゼンタ
- `[38;5;8m` - グレー（ボーダー、ヒント）
- `[96m` - 明るいシアン（ロゴ）
- `[92m` - 明るい緑（ヘルプコマンド）
- `[90m` - 暗いグレー（説明文）

#### カーソル制御
- `[?25l` - カーソル非表示
- `[?25h` - カーソル表示
- `[2K` - 行全体をクリア
- `[1G` - 行の先頭に移動

#### テキスト装飾
- `[1m` - 太字
- `[22m` - 太字解除
- `[0m` - すべてのスタイルをリセット

## 2. メッセージタイプ

### ユーザー入力
```
[38;5;10m>[0m {ユーザーの質問}[0m[0m
```

### アシスタントの応答
通常のテキストとマークダウン形式の混在：
- 通常テキスト: 装飾なし
- コードブロック: `[1m{言語名}[0m` で開始
- コード内容: `[38;5;10m{コード}[0m` で緑色表示

## 3. マークダウンの処理

### コードブロック
```
[1mpython
[0m[38;5;10mdef hello_world():
    """Print a hello world message."""
    print("Hello, World!")
[0m[0m[0m
```

構造：
1. `[1m{言語名}` - 言語名を太字で表示
2. `[0m` - スタイルリセット
3. `[38;5;10m{コード}[0m` - コード本体を緑色で表示
4. `[0m[0m[0m` - 複数のリセット（安全のため）

### インラインコード
インラインコードは特別な処理なし（通常のテキストとして表示）

## 4. 特殊な表示要素

### Did you knowヒント
```
[38;5;8m╭───────────────────────────────[39m Did you know? [38;5;8m────────────────────────────────╮[39m
[38;5;8m│                                                                              │[39m
[38;5;8m│[39m      {ヒント内容}      [38;5;8m│[39m
[38;5;8m│                                                                              │[39m
[38;5;8m╰──────────────────────────────────────────────────────────────────────────────╯[39m
```

### コマンドヘルプバー
```
[92m/help[90m all commands  [1m•[22m  [92mctrl + j[90m new lines  [1m•[22m  [92mctrl + s[90m fuzzy search[39m
[38;5;8m━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━[39m
```

### モデル情報
```
[38;5;14m🤖 You are chatting with claude-3.7-sonnet[39m
```

## 5. ストリーミング出力

出力は段階的に表示される：
1. カーソルを非表示（`[?25l`）
2. テキストを順次出力
3. 完了後カーソルを表示（`[?25h`）

## 6. 出力のパース時の注意点

### エスケープコードの処理
1. ANSIエスケープコードの除去が必要
2. 正規表現: `/\x1b\[[0-9;]*m/g`

### 行の処理
1. `[2K` や `[1G` などの制御コードを適切に処理
2. 実際の出力内容とUIデコレーションを分離

### コードブロックの識別
1. `[1m{言語名}` パターンでコードブロックの開始を検出
2. 連続する `[0m` でコードブロックの終了を検出

## 7. サンプル出力

実際の出力サンプルは `sample-output-1.txt` に保存。

## 8. GUIでの表示に向けた考慮事項

1. **ANSIエスケープコードの変換**
   - 色コードをCSSクラスに変換
   - カーソル制御を無視またはDOM操作に変換

2. **マークダウンレンダリング**
   - コードブロックを適切にハイライト
   - インラインコードのスタイリング

3. **プログレッシブレンダリング**
   - ストリーミング出力をリアルタイムで表示
   - 部分的な出力でも適切に表示

4. **インタラクティブ要素**
   - ツール承認のプロンプト検出
   - ユーザー入力の待機状態の識別